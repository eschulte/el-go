<html><!--Copyright Â© Eric Schulte 2013, all rights reserved--><head><title>weboard</title></head><body><div><button id='host' title='JavaScript is required to connect to an opponent.'>disconnected</button><button id='game' title='Change the game.' onclick='doGame();'><span id='current-game'>game</span></button><button id='resize' title='Clear and resize the board.' onclick='doSize();'>resize</button><button id='color' title='Switch colors with your opponent.' onclick='doColor();'><span id='other-color'>color</span></button><button id='undo' title='Undo the last move.' onclick='doUndo();'>undo</button><br /><div id='board'>JavaScript must be enabled to use this page.</div><div id='stones'><div id='other'></div><div id='me'></div></div><table id='terminals'><tr><th>chat</th></tr><tr><td><input type='text' id='chat-input' /></td></tr><tr><td><pre id='chats'></pre></td></tr></table></div></body><style type="text/css">body{background-color:#232323;color:#E6E1DC}#board table{border-collapse:collapse;border-spacing:0;background:#dcb35c;cursor:crosshair}#board td{padding:0}table#terminals{position:absolute}#stones{position:absolute}button{margin:.5em}</style><script type='text/javascript'>(function(y,s){y(["module"],function(k){function q(c,a,b){Array.isArray(b)||(b=[b]);a in c&&"function"===typeof c[a]&&c[a].apply(c,b)}function p(c,a,b){b instanceof Error||(b=Error(b));q(c,a,[b])}function K(c,a,b,d){return c?(c.push([a,b,d]),!0):!1}function L(c){for(;c.length;){var a=c.shift();q(a[0],a[1],a[2])}}function M(c){this.name="PendingConnectionAbortError";this.message=c||""}function N(c){this.name="ConnectionFailedError";this.message=c||""}function g(c){this.brokerUrl=c;this.state=g.OFFLINE;
this.route=this.socket=this.onerror=this.onreceive=this.onstatechange=null}function t(){this.connectionTimeout=10*A;this.pingTimeout=1*A}function B(c){this.options=c;this.onerror=this.oncomplete=this.onmessage=null;this.complete=!1;this.ports={local:O++,remote:null};this.streams={local:null,remote:null};this.initiator=!1;this.peerConnection=null;this.channels={};this._pending={};this.connectionOptions=this.connectionServers=null;this.channelOptions={RELIABLE:{},UNRELIABLE:{outOfOrderAllowed:!0,maxRetransmitNum:0}}}
function C(c){this.options=c;this.onerror=this.oncomplete=this.onmessage=null;this.complete=!1;this.ports={local:O++,remote:null};this.streams={local:null,remote:null};this.initiator=!1;this.peerConnection=null;this.channels={};this._pending={};this.connectionServers={iceServers:[{url:"stun:23.21.150.121"}]};this.connectionOptions={optional:[{RtpDataChannels:!0}]};this.channelOptions={RELIABLE:{reliable:!1},UNRELIABLE:{reliable:!1}}}function D(c,a,b,d){function e(){h.connected&&(this.connectionTimer=
null,!1===h.messageFlag?(h.channels["@control"].send("ping"),this.pingTimer=window.setTimeout(f,c.pingTimeout)):(h.messageFlag=!1,this.connectionTimer=window.setTimeout(e,c.connectionTimeout)))}function f(){h.connected&&(this.pingTimer=null,!1===h.messageFlag?(h.connected=!1,h.close()):(h.messageFlag=!1,this.connectionTimer=window.setTimeout(e,c.connectionTimeout)))}var h=this;this.id=Q++;this.streams=b;this.messageFlag=this.connected=!1;this.onerror=this.ondisconnect=this.onmessage=null;this.peerConnection=
a;this.channels=d;this.pingTimer=this.connectionTimer=null;Object.keys(this.channels).forEach(function(a){var b=h.channels[a];a.match("^@")||(b.onmessage=function(b){h.messageFlag=!0;q(h,"onmessage",[a,b])})});this.channels["@control"].onmessage=function(a){h.messageFlag=!0;h.connected&&(a=a.data,"ping"===a?h.channels["@control"].send("pong"):"pong"!==a&&"quit"===a&&h.close())};this.connected=!0;this.connectionTimer=window.setTimeout(e,c.connectionTimeout)}function E(c,a){this.route=c;this.incoming=
a;this.proceed=!0}function v(c,a){if(!w)throw Error("WebRTC not supported");var b=this;this.brokerUrl=c;this.options=a=a||{};a.binaryType=a.binaryType||"arraybuffer";a.connectionTimeout=a.connectionTimeout||10*A;a.pingTimeout=a.pingTimeout||1*A;this.onerror=this.onroute=this.onpending=this.onconnection=null;this.broker=new g(c);this.broker.onerror=function(a){p(b,"onerror",a)};this.pending={};this.queues={connected:[],listening:[]};this.broker.onstatechange=function(a,e){b.queues.connected.length&&
b.broker.checkState(g.ROUTED)&&(L(b.queues.connected),b.queues.listening.length&&b.broker.checkState(g.LISTENING)&&L(b.queues.listening));e&g.ROUTED&&q(b,"onroute",b.broker.route)};this.broker.onreceive=function(a,e){var f;if(b.pending.hasOwnProperty(a))f=b.pending[a];else{if(!b.broker.checkState(g.LISTENING))return;var h=new E(a,!0);q(b,"onpending",[h]);if(!h.proceed)return;f=b.pending[a]=new F(b.options);f.oncomplete=function(){var h=new D(b.options,f.peerConnection,f.streams,f.channels);h.route=
a;delete b.pending[a];q(b,"onconnection",[h])};f.onmessage=function(h){b.broker.send(a,h)};f.onerror=function(h){delete b.pending[a];q(b,"onerror",[h])}}f.process(e)};this.broker.connect()}var l="undefined"===typeof k?{}:k.exports;(function(){(function(c,a){c.version="0.9.11";c.protocol=1;c.transports=[];c.j=[];c.sockets={};c.connect=function(b,d){var e=c.util.parseUri(b),f,h;a&&a.location&&(e.protocol=e.protocol||a.location.protocol.slice(0,-1),e.host=e.host||(a.document?a.document.domain:a.location.hostname),
e.port=e.port||a.location.port);f=c.util.uniqueUri(e);var m={host:e.host,secure:"https"==e.protocol,port:e.port||("https"==e.protocol?443:80),query:e.query||""};c.util.merge(m,d);if(m["force new connection"]||!c.sockets[f])h=new c.Socket(m);!m["force new connection"]&&h&&(c.sockets[f]=h);h=h||c.sockets[f];return h.of(1<e.path.length?e.path:"")}})("object"===typeof k?k.exports:l={},s);(function(c,a){var b=c.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.parseUri=function(a){a=d.exec(a||"");for(var b={},f=14;f--;)b[e[f]]=a[f]||"";return b};b.uniqueUri=function(b){var d=b.protocol,f=b.host;b=b.port;"document"in a?(f=f||document.domain,b=b||("https"==d&&"https:"!==document.location.protocol?443:document.location.port)):(f=f||"localhost",b||"https"!=d||(b=443));return(d||"http")+"://"+f+":"+(b||80)};b.query=function(a,d){var f=b.chunkQuery(a||
""),e=[];b.merge(f,b.chunkQuery(d||""));for(var c in f)f.hasOwnProperty(c)&&e.push(c+"="+f[c]);return e.length?"?"+e.join("&"):""};b.chunkQuery=function(a){var b={};a=a.split("&");for(var d=0,f=a.length,e;d<f;++d)e=a[d].split("="),e[0]&&(b[e[0]]=e[1]);return b};var f=!1;b.load=function(h){if("document"in a&&"complete"===document.readyState||f)return h();b.on(a,"load",h,!1)};b.on=function(a,b,d,f){a.attachEvent?a.attachEvent("on"+b,d):a.addEventListener&&a.addEventListener(b,d,f)};b.request=function(a){if(a&&
"undefined"!=typeof XDomainRequest&&!b.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||b.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new (window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(d){}return null};"undefined"!=typeof window&&b.load(function(){f=!0});b.defer=function(a){if(!b.ua.webkit||"undefined"!=typeof importScripts)return a();b.load(function(){setTimeout(a,100)})};b.merge=function(a,d,f,e){e=e||[];f="undefined"==typeof f?
2:f;for(var c in d)d.hasOwnProperty(c)&&0>b.indexOf(e,c)&&("object"===typeof a[c]&&f?b.merge(a[c],d[c],f-1,e):(a[c]=d[c],e.push(d[c])));return a};b.mixin=function(a,d){b.merge(a.prototype,d.prototype)};b.inherit=function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d};b.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.intersect=function(a,d){for(var f=[],e=a.length>d.length?a:d,c=a.length>d.length?d:a,r=0,R=c.length;r<R;r++)~b.indexOf(e,
c[r])&&f.push(c[r]);return f};b.indexOf=function(a,b,d){var f=a.length;for(d=0>d?0>d+f?0:d+f:d||0;d<f&&a[d]!==b;d++);return f<=d?-1:d};b.toArray=function(a){for(var b=[],d=0,f=a.length;d<f;d++)b.push(a[d]);return b};b.ua={};b.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(b){return!1}return void 0!=a.withCredentials}();b.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);b.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)})("undefined"!=
typeof l?l:k.exports,s);(function(c,a){function b(){}c.EventEmitter=b;b.prototype.on=function(b,e){this.$events||(this.$events={});this.$events[b]?a.util.isArray(this.$events[b])?this.$events[b].push(e):this.$events[b]=[this.$events[b],e]:this.$events[b]=e;return this};b.prototype.addListener=b.prototype.on;b.prototype.once=function(a,b){function f(){h.removeListener(a,f);b.apply(this,arguments)}var h=this;f.listener=b;this.on(a,f);return this};b.prototype.removeListener=function(b,e){if(this.$events&&
this.$events[b]){var f=this.$events[b];if(a.util.isArray(f)){for(var h=-1,c=0,n=f.length;c<n;c++)if(f[c]===e||f[c].listener&&f[c].listener===e){h=c;break}if(0>h)return this;f.splice(h,1);f.length||delete this.$events[b]}else(f===e||f.listener&&f.listener===e)&&delete this.$events[b]}return this};b.prototype.removeAllListeners=function(a){if(void 0===a)return this.$events={},this;this.$events&&this.$events[a]&&(this.$events[a]=null);return this};b.prototype.listeners=function(b){this.$events||(this.$events=
{});this.$events[b]||(this.$events[b]=[]);a.util.isArray(this.$events[b])||(this.$events[b]=[this.$events[b]]);return this.$events[b]};b.prototype.emit=function(b){if(!this.$events)return!1;var c=this.$events[b];if(!c)return!1;var f=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,f);else if(a.util.isArray(c))for(var c=c.slice(),h=0,m=c.length;h<m;h++)c[h].apply(this,f);else return!1;return!0}})("undefined"!=typeof l?l:k.exports,"undefined"!=typeof l?l:k.parent.exports);
(function(c,a){function b(a){return 10>a?"0"+a:a}function d(a){m.lastIndex=0;return m.test(a)?'"'+a.replace(m,function(a){var b=x[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(a,f){var c,h,m,x,l=n,g,k=f[a];k instanceof Date&&(k=isFinite(a.valueOf())?a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z":null);"function"===typeof r&&(k=r.call(f,a,
k));switch(typeof k){case "string":return d(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);case "object":if(!k)return"null";n+=z;g=[];if("[object Array]"===Object.prototype.toString.apply(k)){x=k.length;for(c=0;c<x;c+=1)g[c]=e(c,k)||"null";m=0===g.length?"[]":n?"[\n"+n+g.join(",\n"+n)+"\n"+l+"]":"["+g.join(",")+"]";n=l;return m}if(r&&"object"===typeof r)for(x=r.length,c=0;c<x;c+=1)"string"===typeof r[c]&&(h=r[c],(m=e(h,k))&&g.push(d(h)+(n?": ":":")+
m));else for(h in k)Object.prototype.hasOwnProperty.call(k,h)&&(m=e(h,k))&&g.push(d(h)+(n?": ":":")+m);m=0===g.length?"{}":n?"{\n"+n+g.join(",\n"+n)+"\n"+l+"}":"{"+g.join(",")+"}";n=l;return m}}if(a&&a.parse)return c.JSON={parse:a.parse,stringify:a.stringify};var f=c.JSON={},h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
n,z,x={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r;f.stringify=function(a,b,d){var f;z=n="";if("number"===typeof d)for(f=0;f<d;f+=1)z+=" ";else"string"===typeof d&&(z=d);if((r=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return e("",{"":a})};f.parse=function(a,b){function d(a,f){var c,h,e=a[f];if(e&&"object"===typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(h=d(e,c),void 0!==h?e[c]=h:
delete e[c]);return b.call(a,f,e)}var f;a=String(a);h.lastIndex=0;h.test(a)&&(a=a.replace(h,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof b?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})("undefined"!=typeof l?l:k.exports,"undefined"!==
typeof JSON?JSON:void 0);(function(c,a){var b=c.parser={},d=b.packets="disconnect connect heartbeat message json event ack error noop".split(" "),e=b.reasons=["transport not supported","client not handshaken","unauthorized"],f=b.advice=["reconnect"],h=a.JSON,m=a.util.indexOf;b.encodePacket=function(a){var b=m(d,a.type),c=a.id||"",n=a.endpoint||"",l=a.ack,g=null;switch(a.type){case "error":var k=a.reason?m(e,a.reason):"";a=a.advice?m(f,a.advice):"";if(""!==k||""!==a)g=k+(""!==a?"+"+a:"");break;case "message":""!==
a.data&&(g=a.data);break;case "event":g={name:a.name};a.args&&a.args.length&&(g.args=a.args);g=h.stringify(g);break;case "json":g=h.stringify(a.data);break;case "connect":a.qs&&(g=a.qs);break;case "ack":g=a.ackId+(a.args&&a.args.length?"+"+h.stringify(a.args):"")}b=[b,c+("data"==l?"+":""),n];null!==g&&void 0!==g&&b.push(g);return b.join(":")};b.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var d=0,f=a.length;d<f;d++)b+="\ufffd"+a[d].length+"\ufffd"+a[d];return b};var n=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;
b.decodePacket=function(a){var b=a.match(n);if(!b)return{};var c=b[2]||"";a=b[5]||"";var m={type:d[b[1]],endpoint:b[4]||""};c&&(m.id=c,m.ack=b[3]?"data":!0);switch(m.type){case "error":b=a.split("+");m.reason=e[b[0]]||"";m.advice=f[b[1]]||"";break;case "message":m.data=a||"";break;case "event":try{var g=h.parse(a);m.name=g.name;m.args=g.args}catch(l){}m.args=m.args||[];break;case "json":try{m.data=h.parse(a)}catch(k){}break;case "connect":m.qs=a||"";break;case "ack":if(b=a.match(/^([0-9]+)(\+)?(.*)/))if(m.ackId=
b[1],m.args=[],b[3])try{m.args=b[3]?h.parse(b[3]):[]}catch(q){}}return m};b.decodePayload=function(a){if("\ufffd"==a.charAt(0)){for(var d=[],f=1,c="";f<a.length;f++)"\ufffd"==a.charAt(f)?(d.push(b.decodePacket(a.substr(f+1).substr(0,c))),f+=Number(c)+1,c=""):c+=a.charAt(f);return d}return[b.decodePacket(a)]}})("undefined"!=typeof l?l:k.exports,"undefined"!=typeof l?l:k.parent.exports);(function(c,a){function b(a,b){this.socket=a;this.sessid=b}c.Transport=b;a.util.mixin(b,a.EventEmitter);b.prototype.heartbeats=
function(){return!0};b.prototype.onData=function(b){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(""!==b&&(b=a.parser.decodePayload(b))&&b.length)for(var c=0,f=b.length;c<f;c++)this.onPacket(b[c]);return this};b.prototype.onPacket=function(a){this.socket.setHeartbeatTimeout();if("heartbeat"==a.type)return this.onHeartbeat();if("connect"==a.type&&""==a.endpoint)this.onConnect();"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=
!1);this.socket.onPacket(a);return this};b.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}};b.prototype.onDisconnect=function(){this.isOpen&&this.close();this.clearTimeouts();this.socket.onDisconnect();return this};b.prototype.onConnect=function(){this.socket.onConnect();return this};b.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=
null)};b.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};b.prototype.packet=function(b){this.send(a.parser.encodePacket(b))};b.prototype.onHeartbeat=function(a){this.packet({type:"heartbeat"})};b.prototype.onOpen=function(){this.isOpen=!0;this.clearCloseTimeout();this.socket.onOpen()};b.prototype.onClose=function(){this.isOpen=!1;this.socket.onClose();this.onDisconnect()};b.prototype.prepareUrl=function(){var b=this.socket.options;
return this.scheme()+"://"+b.host+":"+b.port+"/"+b.resource+"/"+a.protocol+"/"+this.name+"/"+this.sessid};b.prototype.ready=function(a,b){b.call(this)}})("undefined"!=typeof l?l:k.exports,"undefined"!=typeof l?l:k.parent.exports);(function(c,a,b){function d(f){this.options={port:80,secure:!1,document:"document"in b?document:!1,resource:"socket.io",transports:a.transports,"connect timeout":1E4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3E3,
"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1};a.util.merge(this.options,f);this.reconnecting=this.connecting=this.open=this.connected=!1;this.namespaces={};this.buffer=[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||a.util.ua.hasCORS)){var c=this;a.util.on(b,"beforeunload",function(){c.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}c.Socket=d;a.util.mixin(d,
a.EventEmitter);d.prototype.of=function(b){this.namespaces[b]||(this.namespaces[b]=new a.SocketNamespace(this,b),""!==b&&this.namespaces[b].packet({type:"connect"}));return this.namespaces[b]};d.prototype.publish=function(){this.emit.apply(this,arguments);var a,b;for(b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))};d.prototype.handshake=function(b){function c(a){a instanceof Error?(d.connecting=!1,d.onError(a.message)):b.apply(null,a.split(":"))}var d=
this,n=this.options,n=["http"+(n.secure?"s":"")+":/",n.host+":"+n.port,n.resource,a.protocol,a.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!a.util.ua.hasCORS){var g=document.getElementsByTagName("script")[0],l=document.createElement("script");l.src=n+"&jsonp="+a.j.length;g.parentNode.insertBefore(l,g);a.j.push(function(a){c(a);l.parentNode.removeChild(l)})}else{var k=a.util.request();k.open("GET",n,!0);this.isXDomain()&&(k.withCredentials=!0);k.onreadystatechange=
function(){if(4==k.readyState)if(k.onreadystatechange=e,200==k.status)c(k.responseText);else if(403==k.status)d.onError(k.responseText);else d.connecting=!1,!d.reconnecting&&d.onError(k.responseText)};k.send(null)}};d.prototype.getTransport=function(b){b=b||this.transports;for(var c=0,d;d=b[c];c++)if(a.Transport[d]&&a.Transport[d].check(this)&&(!this.isXDomain()||a.Transport[d].xdomainCheck(this)))return new a.Transport[d](this,this.sessionid);return null};d.prototype.connect=function(b){if(this.connecting)return this;
var c=this;c.connecting=!0;this.handshake(function(d,e,g,k){function l(a){c.transport&&c.transport.clearTimeouts();c.transport=c.getTransport(a);if(!c.transport)return c.publish("connect_failed");c.transport.ready(c,function(){c.connecting=!0;c.publish("connecting",c.transport.name);c.transport.open();c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){for(var a=c.transports;0<a.length&&a.splice(0,1)[0]!=
c.transport.name;);a.length?l(a):c.publish("connect_failed")}},c.options["connect timeout"]))})}c.sessionid=d;c.closeTimeout=1E3*g;c.heartbeatTimeout=1E3*e;c.transports||(c.transports=c.origTransports=k?a.util.intersect(k.split(","),c.options.transports):c.options.transports);c.setHeartbeatTimeout();l(c.transports);c.once("connect",function(){clearTimeout(c.connectTimeoutTimer);b&&"function"==typeof b&&b()})});return this};d.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);
if(!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}};d.prototype.packet=function(a){this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a);return this};d.prototype.setBuffer=function(a){this.doBuffer=a;!a&&(this.connected&&this.buffer.length)&&(this.options.manualFlush||this.flushBuffer())};d.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};
d.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this};d.prototype.disconnectSync=function(){var b=a.util.request(),c=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,a.protocol,"",this.sessionid].join("/")+"/?disconnect=1";b.open("GET",c,!1);b.send(null);this.onDisconnect("booted")};d.prototype.isXDomain=function(){var a=b.location.port||
("https:"==b.location.protocol?443:80);return this.options.host!==b.location.hostname||this.options.port!=a};d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))};d.prototype.onOpen=function(){this.open=!0};d.prototype.onClose=function(){this.open=!1;clearTimeout(this.heartbeatTimeoutTimer)};d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)};d.prototype.onError=function(a){a&&a.advice&&("reconnect"===
a.advice&&(this.connected||this.connecting))&&(this.disconnect(),this.options.reconnect&&this.reconnect());this.publish("error",a&&a.reason?a.reason:a)};d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.open=this.connecting=this.connected=!1;if(b||c)this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&(this.options.reconnect&&!this.reconnecting)&&this.reconnect())};d.prototype.reconnect=function(){function a(){if(c.connected){for(var d in c.namespaces)c.namespaces.hasOwnProperty(d)&&
""!==d&&c.namespaces[d].packet({type:"connect"});c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer);c.removeListener("connect_failed",b);c.removeListener("connect",b);c.reconnecting=!1;delete c.reconnectionAttempts;delete c.reconnectionDelay;delete c.reconnectionTimer;delete c.redoTransports;c.options["try multiple transports"]=e}function b(){if(c.reconnecting){if(c.connected)return a();if(c.connecting&&c.reconnecting)return c.reconnectionTimer=setTimeout(b,
1E3);c.reconnectionAttempts++>=d?c.redoTransports?(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transports=c.origTransports,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<g&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay))}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=
this.options["reconnection delay"];var c=this,d=this.options["max reconnection attempts"],e=this.options["try multiple transports"],g=this.options["reconnection limit"];this.options["try multiple transports"]=!1;this.reconnectionTimer=setTimeout(b,this.reconnectionDelay);this.on("connect",b)}})("undefined"!=typeof l?l:k.exports,"undefined"!=typeof l?l:k.parent.exports,s);(function(c,a){function b(a,b){this.socket=a;this.name=b||"";this.flags={};this.json=new d(this,"json");this.ackPackets=0;this.acks=
{}}function d(a,b){this.namespace=a;this.name=b}c.SocketNamespace=b;a.util.mixin(b,a.EventEmitter);b.prototype.$emit=a.EventEmitter.prototype.emit;b.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};b.prototype.packet=function(a){a.endpoint=this.name;this.socket.packet(a);this.flags={};return this};b.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b);return this.packet(c)};
b.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1));d.args=b;return this.packet(d)};b.prototype.disconnect=function(){""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect"));return this};b.prototype.onPacket=function(b){function c(){d.packet({type:"ack",args:a.util.toArray(arguments),ackId:b.id})}
var d=this;switch(b.type){case "connect":this.$emit("connect");break;case "disconnect":if(""===this.name)this.socket.onDisconnect(b.reason||"booted");else this.$emit("disconnect",b.reason);break;case "message":case "json":var m=["message",b.data];"data"==b.ack?m.push(c):b.ack&&this.packet({type:"ack",ackId:b.id});this.$emit.apply(this,m);break;case "event":m=[b.name].concat(b.args);"data"==b.ack&&m.push(c);this.$emit.apply(this,m);break;case "ack":this.acks[b.ackId]&&(this.acks[b.ackId].apply(this,
b.args),delete this.acks[b.ackId]);break;case "error":if(b.advice)this.socket.onError(b);else"unauthorized"==b.reason?this.$emit("connect_failed",b.reason):this.$emit("error",b.reason)}};d.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};d.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof l?l:k.exports,"undefined"!=typeof l?l:k.parent.exports);(function(c,
a,b){function d(b){a.Transport.apply(this,arguments)}c.websocket=d;a.util.inherit(d,a.Transport);d.prototype.name="websocket";d.prototype.open=function(){var c=a.util.query(this.socket.options.query),d=this,h;h||(h=b.MozWebSocket||b.WebSocket);this.websocket=new h(this.prepareUrl()+c);this.websocket.onopen=function(){d.onOpen();d.socket.setBuffer(!1)};this.websocket.onmessage=function(a){d.onData(a.data)};this.websocket.onclose=function(){d.onClose();d.socket.setBuffer(!0)};this.websocket.onerror=
function(a){d.onError(a)};return this};d.prototype.send=a.util.ua.iDevice?function(a){var b=this;setTimeout(function(){b.websocket.send(a)},0);return this}:function(a){this.websocket.send(a);return this};d.prototype.payload=function(a){for(var b=0,c=a.length;b<c;b++)this.packet(a[b]);return this};d.prototype.close=function(){this.websocket.close();return this};d.prototype.onError=function(a){this.socket.onError(a)};d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};d.check=
function(){return"WebSocket"in b&&!("__addTask"in WebSocket)||"MozWebSocket"in b};d.xdomainCheck=function(){return!0};a.transports.push("websocket")})("undefined"!=typeof l?l.Transport:k.exports,"undefined"!=typeof l?l:k.parent.exports,s);(function(){if("undefined"!=typeof window&&!window.WebSocket){var c=window.console;c&&c.log&&c.error||(c={log:function(){},error:function(){}});swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&c.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),
WebSocket=function(a,b,c,e,f){var h=this;h.__id=WebSocket.__nextId++;WebSocket.__instances[h.__id]=h;h.readyState=WebSocket.CONNECTING;h.bufferedAmount=0;h.__events={};b?"string"==typeof b&&(b=[b]):b=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(h.__id,a,b,c||null,e||0,f||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,
encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b,c){a in this.__events||(this.__events[a]=[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b,c){if(a in this.__events)for(a=this.__events[a],c=a.length-1;0<=c;--c)if(a[c]===
b){a.splice(c,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);(b=this["on"+a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);"protocol"in a&&(this.protocol=a.protocol);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",
a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",!1,!1,b,null,null,window,null);return c}return{type:a,
data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");
a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||c.error("[WebSocket] swfobject.embedSWF failed")})}else c.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},
WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),b=0;b<a.length;++b)WebSocket.__instances[a[b].webSocketId].__handleEvent(a[b])}catch(d){c.error(d)}},
0);return!0},WebSocket.__log=function(a){c.log(decodeURIComponent(a))},WebSocket.__error=function(a){c.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||
(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):c.error("Flash Player >= 10.0.0 is required.")}})();(function(c,a,b){function d(b){b&&(a.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}c.XHR=d;a.util.inherit(d,a.Transport);d.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};d.prototype.payload=function(b){for(var c=
[],d=0,e=b.length;d<e;d++)c.push(a.parser.encodePacket(b[d]));this.send(a.parser.encodePayload(c))};d.prototype.send=function(a){this.post(a);return this};d.prototype.post=function(a){function c(){if(4==this.readyState)if(this.onreadystatechange=e,g.posting=!1,200==this.status)g.socket.setBuffer(!1);else g.onClose()}function d(){this.onload=e;g.socket.setBuffer(!1)}var g=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");b.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=
this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=c;this.sendXHR.send(a)};d.prototype.close=function(){this.onClose();return this};d.prototype.request=function(b){var c=a.util.request(this.socket.isXDomain()),d=a.util.query(this.socket.options.query,"t="+ +new Date);c.open(b||"GET",this.prepareUrl()+d,!0);if("POST"==b)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(e){}return c};d.prototype.scheme=function(){return this.socket.options.secure?
"https":"http"};d.check=function(c,d){try{var e=a.util.request(d),g=b.XDomainRequest&&e instanceof XDomainRequest,k=c&&c.options&&c.options.secure?"https:":"http:",l=b.location&&k!=b.location.protocol;if(e&&(!g||!l))return!0}catch(q){}return!1};d.xdomainCheck=function(a){return d.check(a,!0)}})("undefined"!=typeof l?l.Transport:k.exports,"undefined"!=typeof l?l:k.parent.exports,s);(function(c,a){function b(b){a.Transport.XHR.apply(this,arguments)}c.htmlfile=b;a.util.inherit(b,a.Transport.XHR);b.prototype.name=
"htmlfile";b.prototype.get=function(){this.doc=new (window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var b=this.doc.createElement("div");b.className="socketio";this.doc.body.appendChild(b);this.iframe=this.doc.createElement("iframe");b.appendChild(this.iframe);var c=this,b=a.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+b;a.util.on(window,"unload",function(){c.destroy()})};
b.prototype._=function(a,b){this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(h){}};b.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};b.prototype.close=function(){this.destroy();return a.Transport.XHR.prototype.close.call(this)};b.check=function(b){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in
window)try{return new (window[["Active"].concat("Object").join("X")])("htmlfile")&&a.Transport.XHR.check(b)}catch(c){}return!1};b.xdomainCheck=function(){return!1};a.transports.push("htmlfile")})("undefined"!=typeof l?l.Transport:k.exports,"undefined"!=typeof l?l:k.parent.exports);(function(c,a,b){function d(){a.Transport.XHR.apply(this,arguments)}function e(){}c["xhr-polling"]=d;a.util.inherit(d,a.Transport.XHR);a.util.merge(d,a.Transport.XHR);d.prototype.name="xhr-polling";d.prototype.heartbeats=
function(){return!1};d.prototype.open=function(){a.Transport.XHR.prototype.open.call(this);return!1};d.prototype.get=function(){function a(){if(4==this.readyState)if(this.onreadystatechange=e,200==this.status)g.onData(this.responseText),g.get();else g.onClose()}function c(){this.onerror=this.onload=e;g.retryCounter=1;g.onData(this.responseText);g.get()}function d(){g.retryCounter++;if(!g.retryCounter||3<g.retryCounter)g.onClose();else g.get()}if(this.isOpen){var g=this;this.xhr=this.request();b.XDomainRequest&&
this.xhr instanceof XDomainRequest?(this.xhr.onload=c,this.xhr.onerror=d):this.xhr.onreadystatechange=a;this.xhr.send(null)}};d.prototype.onClose=function(){a.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(b){}this.xhr=null}};d.prototype.ready=function(b,c){var d=this;a.util.defer(function(){c.call(d)})};a.transports.push("xhr-polling")})("undefined"!=typeof l?l.Transport:k.exports,"undefined"!=typeof l?
l:k.parent.exports,s);(function(c,a,b){function d(b){a.Transport["xhr-polling"].apply(this,arguments);this.index=a.j.length;var c=this;a.j.push(function(a){c._(a)})}var e=b.document&&"MozAppearance"in b.document.documentElement.style;c["jsonp-polling"]=d;a.util.inherit(d,a.Transport["xhr-polling"]);d.prototype.name="jsonp-polling";d.prototype.post=function(b){function c(){d();e.socket.setBuffer(!1)}function d(){e.iframe&&e.form.removeChild(e.iframe);try{p=document.createElement('<iframe name="'+e.iframeId+
'">')}catch(a){p=document.createElement("iframe"),p.name=e.iframeId}p.id=e.iframeId;e.form.appendChild(p);e.iframe=p}var e=this,g=a.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var k=document.createElement("form"),l=document.createElement("textarea"),q=this.iframeId="socketio_iframe_"+this.index,p;k.className="socketio";k.style.position="absolute";k.style.top="0px";k.style.left="0px";k.style.display="none";k.target=q;k.method="POST";k.setAttribute("accept-charset",
"utf-8");l.name="d";k.appendChild(l);document.body.appendChild(k);this.form=k;this.area=l}this.form.action=this.prepareUrl()+g;d();this.area.value=a.JSON.stringify(b);try{this.form.submit()}catch(s){}this.iframe.attachEvent?p.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c;this.socket.setBuffer(!0)};d.prototype.get=function(){var b=this,c=document.createElement("script"),d=a.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&
(this.script.parentNode.removeChild(this.script),this.script=null);c.async=!0;c.src=this.prepareUrl()+d;c.onerror=function(){b.onClose()};d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);this.script=c;e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};d.prototype._=function(a){this.onData(a);this.isOpen&&this.get();return this};d.prototype.ready=function(b,c){var d=this;if(!e)return c.call(this);
a.util.load(function(){c.call(d)})};d.check=function(){return"document"in b};d.xdomainCheck=function(){return!0};a.transports.push("jsonp-polling")})("undefined"!=typeof l?l.Transport:k.exports,"undefined"!=typeof l?l:k.parent.exports,s);"function"===typeof y&&y.amd&&y([],function(){return l})})();var w=!0,G;window.mozRTCPeerConnection?G=window.mozRTCPeerConnection:window.webkitRTCPeerConnection?G=window.webkitRTCPeerConnection:window.RTCPeerConnection?G=window.RTCPeerConnection:w=!1;var u;window.mozRTCSessionDescription?
u=window.mozRTCSessionDescription:window.webkitRTCSessionDescription?u=window.webkitRTCSessionDescription:window.RTCSessionDescription?u=window.RTCSessionDescription:w=!1;var H;window.mozRTCIceCandidate?H=window.mozRTCIceCandidate:window.webkitRTCIceCandidate?H=window.webkitRTCIceCandidate:window.RTCIceCandidate?H=window.RTCIceCandidate:w=!1;var I;navigator.getUserMedia?I=navigator.getUserMedia.bind(navigator):navigator.mozGetUserMedia?I=navigator.mozGetUserMedia.bind(navigator):navigator.webkitGetUserMedia?
I=navigator.webkitGetUserMedia.bind(navigator):w=!1;var F;window.mozRTCPeerConnection?F=B:window.webkitRTCPeerConnection?F=C:w=!1;var A=1E3;M.prototype=Error.prototype;N.prototype=Error.prototype;var P={PendingConnectionAbortError:M,ConnectionFailedError:N};g.OFFLINE=1;g.CONNECTING=2;g.CONNECTED=4;g.ROUTED=16;g.LISTENING=32;g.prototype.setState=function(c,a){var b=a?0:240;this.state&=b>>>0;this.state|=c>>>0;q(this,"onstatechange",[this.state,(c|b&0)>>>0])};g.prototype.setFlag=function(c){this.state=
(this.state|c)>>>0;q(this,"onstatechange",[this.state,c])};g.prototype.clearFlag=function(c){c=~c>>>0;this.state=(this.state&c)>>>0;q(this,"onstatechange",[this.state,c])};g.prototype.checkState=function(c){return!!(this.state&c)};g.prototype.connect=function(){var c=this,a=l.connect(this.brokerUrl+"/peer",{"sync disconnect on unload":!0});a.on("connecting",function(){c.setState(g.CONNECTING,!0)});a.on("connect",function(){c.setState(g.CONNECTED,!0)});a.on("connect_failed",function(){c.setState(g.OFFLINE,
!0)});a.on("route",function(a){c.route=a;c.setFlag(g.ROUTED)});a.on("disconnect",function(){c.setState(g.OFFLINE,!0)});a.on("error",function(a){console.error(a);p(c,"onerror",a)});a.on("receive",function(a){q(c,"onreceive",[a.from,a.data])});this.socket=a};g.prototype.disconnect=function(){return this.checkState(g.CONNECTED)?(this.socket.disconnect(),this.setState(g.OFFLINE,!0),!0):!1};g.prototype.listen=function(c){var a=this;this.checkState(g.CONNECTED)&&this.socket.emit("listen",c,function(b){b&&
b.error?p(a,"onerror",Error(b.error)):a.setFlag(g.LISTENING)})};g.prototype.ignore=function(){var c=this;this.checkState(g.CONNECTED)&&this.socket.emit("ignore",null,function(a){a&&a.error?p(c,"onerror",Error(a.error)):c.clearFlag(g.LISTENING)})};g.prototype.send=function(c,a){var b=this;this.checkState(g.CONNECTED)&&this.socket.emit("send",{to:c,data:a},function(a){a&&a.error&&p(b,"onerror",Error(a.error))})};var J={reliable:"RELIABLE",unreliable:"UNRELIABLE","@control":"RELIABLE"},O=1;t.prototype.process=
function(c){switch(c.type){case "ice":(c=JSON.parse(c.candidate))&&this.handleIce(c);break;case "offer":this.ports.remote=c.port;this.handleOffer({type:"offer",sdp:c.description});break;case "answer":this.ports.remote=c.port;this.handleAnswer({type:"answer",sdp:c.description});break;case "abort":this.handleAbort();break;default:p(this,"onerror","unknown message")}};t.prototype.handleAbort=function(){p(this,"onerror",Error(P.RTCConnectProtocolAbort))};t.prototype.initialize=function(c){function a(d){d=
e||f?d:!0;var e=!!b.options.video,f=!!b.options.audio;I({video:e,audio:e||f?f:!0,fake:d},function(a){b.peerConnection.addStream(a);b.streams.local=a;c()},function(c){console.error("!",c);d?p(b,"onerror",c):a(!0)})}var b=this;if(this.peerConnection)return c();this.peerConnection=new G(this.connectionServers,this.connectionOptions);this.peerConnection.onicecandidate=function(a){a={type:"ice",candidate:JSON.stringify(a.candidate)};q(b,"onmessage",a)};this.peerConnection.onaddstream=function(a){b.streams.remote=
a.stream};this.peerConnection.onstatechange=function(a){console.log(a.target.readyState)};a()};t.prototype.handleIce=function(c){var a=this;this.initialize(function(){a.peerConnection.remoteDescription&&a.peerConnection.addIceCandidate(new H(c),function(b){p(a,"onerror",b)})})};t.prototype.initiate=function(){function c(){b.peerConnection.createOffer(a,function(a){p(b,"onerror",a)})}function a(a){b.peerConnection.setLocalDescription(new u(a),function(){q(b,"onmessage",{type:"offer",description:a.sdp,
port:b.ports.local})},function(a){p(b,"onerror",a)})}var b=this;this.initiator=!0;this.initialize(function(){var a=Object.keys(J);a.forEach(function(c){var f=b._pending[c]=b.peerConnection.createDataChannel(c,b.channelOptions[J[c]]);f.binaryType=b.options.binaryType;f.onopen=function(){b.channels[c]=f;delete b._pending[c];Object.keys(b.channels).length===a.length&&(b.complete=!0,q(b,"oncomplete",[]))};f.onerror=function(a){console.error(a);p(b,"onerror",a)}});c()})};t.prototype.handleOffer=function(c){function a(){e.peerConnection.setRemoteDescription(new u(c),
b,function(a){p(e,"onerror",a)})}function b(){e.peerConnection.createAnswer(d,function(a){p(e,"onerror",a)})}function d(a){e.peerConnection.setLocalDescription(new u(a),function(){q(e,"onmessage",{type:"answer",description:a.sdp,port:e.ports.local})},function(a){p(e,"onerror",a)})}var e=this;this.initialize(function(){var b=Object.keys(J);e.peerConnection.ondatachannel=function(a){var c=a.channel,d=c.label;e._pending[d]=c;c.binaryType=e.options.binaryType;c.onopen=function(){e.channels[d]=c;delete e._pending[d];
Object.keys(e.channels).length===b.length&&(e.complete=!0,q(e,"oncomplete",[]))};c.onerror=function(a){console.error(a);p(e,"onerror",a)}};a()})};t.prototype.handleAnswer=function(c){function a(){}var b=this;this.initialize(function(){b.peerConnection.setRemoteDescription(new u(c),a,function(a){p(b,"onerror",a)})})};B.prototype=new t;B.prototype.constructor=B;C.prototype=new t;C.prototype.constructor=C;var Q=1;D.prototype.close=function(){console.log("close connection");this.connected&&this.channels["@control"].send("quit");
this.connected=!1;this.peerConnection.close();this.connectionTimer&&(window.clearInterval(this.connectionTimer),this.connectionTimer=null);this.pingTimer&&(window.clearInterval(this.pingTimer),this.pingTimer=null);this.peerConnection=null;q(this,"ondisconnect",[])};D.prototype.send=function(c,a){this.channels[c].send(a)};E.prototype.accept=function(){this.proceed=!0};E.prototype.reject=function(){this.proceed=!1};v.prototype.listen=function(c){if(!this.broker.checkState(g.ROUTED))return K(this.queues.connected,
this,"listen",[c]);c=c||{};c.url=c.url||window.location.toString();c.listed=void 0!==c.listed?c.listed:!0;c.metadata=c.metadata||{};this.broker.listen(c)};v.prototype.ignore=function(){throw Error("not implemented");};v.prototype.connect=function(c){if(!this.broker.checkState(g.ROUTED))return K(this.queues.connected,this,"connect",[c]);var a=this;if(this.pending.hasOwnProperty(c))throw Error("already connecting to this host");var b=new E(c,!1);q(a,"onpending",[b]);if(b.proceed){var d=this.pending[c]=
new F(this.options);d.oncomplete=function(){var b=new D(this.options,d.peerConnection,d.streams,d.channels);b.route=c;delete a.pending[c];q(a,"onconnection",[b])};d.onmessage=function(b){a.broker.send(c,b)};d.onerror=function(b){delete a.pending[c];p(a,"onerror",b)};d.initiate()}};v.prototype.close=function(){this.broker.disconnect()};v.E=P;return v})})("function"==typeof define&&define.amd?define:function(y,s){"object"===typeof exports?module.exports=s():this.Peer=s()},this);
function member(a,b){for(var c=arguments.length,d=2;d<c;d+=2)switch(arguments[d]){case "test":e=arguments[d+1]}for(var e,c=null,d=0;d<b.length;d+=1)if(c=b[d],null==e?c===a:e(c,a))return!0;return!1}function union(a,b){for(var c=arguments.length,d=2;d<c;d+=2)switch(arguments[d]){case "test":e=arguments[d+1]}var e="undefined"===typeof e?equals:e;return a.concat(function(){for(var c=b.length,d=[],h=0;h<c;h+=1){var k=b[h];member(k,a,"test",e)||d.push(k)}return d}())}
function map(a,b){for(var c=0,d=[],e=null,f=0;f<b.length;f+=1)e=b[f],d[c]=a(e),c+=1;return d}function zerop(a){return 0==a}function some(a,b){for(var c=b.length,d=0;d<c;d+=1)if(a(b[d]))return!0;return!1}function all(a,b){for(var c=b.length,d=0;d<c;d+=1)if(!a(b[d]))return!1;return!0}function removeIf(a,b){for(var c=b.length,d=[],e=0;e<c;e+=1){var f=b[e];a(f)||d.push(f)}return d}function removeIfNot(a,b){for(var c=b.length,d=[],e=0;e<c;e+=1){var f=b[e];a(f)&&d.push(f)}return d}
var game="go",lastCulled,lastMoved,prison={black:null,white:null},gtp={},sgf={moves:[]},board={innerSize:null},backends=[gtp,board,sgf],moveStart=null,hosting=!0,brokerUrl="https://mdsw.ch:8080",peer=new Peer(brokerUrl,{video:!1,audio:!1}),brokerSession=null,color=hosting?"white":"black";function updateColor(){return document.getElementById("other-color").innerHTML="be "+otherColor(color)}updateColor();
(function(){for(var a=window.location.search.substring(1).split("&"),b=a.length,c=0;c<b;c+=1){var d=a[c];/^webrtc-(session|broker)/.exec(d)?(brokerSession=d.split("=")[1],hosting=!1):/^color/.exec(d)?(color=d.split("=")[1],updateColor()):/^game/.exec(d)&&(game=d.split("=")[1])}return null})();window.connections={};
peer.onconnection=function(a){console.log("connected");document.getElementById("host").innerHTML="connected";document.getElementById("host").onclick=function(){return alert("already connected")};document.getElementById("host").title="This board is connected to an opponent.";connections[a.id]=a;a.ondisconnect=function(){console.log("disconnected from "+a.id);document.getElementById("host").innerHTML="disconnected";return delete connections[a.id]};return a.onmessage=function(a,c){return gtpHandle(c.data)}};
peer.onerror=function(a){return error("peer error: ",a)};
hosting?(peer.listen({metadata:{name:"weboard"}}),document.getElementById("host").title="Connecting to the signaling server.",peer.onroute=function(a){var b=window.location.toString().split("?"),c=(b[1]||"").split("&");c.push("webrtc-session="+a);b[1]=c.join("&");document.getElementById("host").title="Send this URL to your opponent.  Click to copy.";document.getElementById("host").innerHTML="<a href="+b.join("?")+">connect</a>";return document.getElementById("host").onclick=function(){return prompt("send this URL to your opponent",
b.join("?"))}}):(document.getElementById("host").title="Connecting to game '"+brokerSession+"' .",peer.connect(brokerSession));window.onbeforeunload=function(){Object.keys(connections).forEach(function(a){return connections[a].close()});return peer.close()};function send(a){return Object.keys(connections).forEach(function(b){return connections[b].send("reliable",a)})}
document.getElementById("console-input")&&document.getElementById("console-input").addEventListener("keyup",function(a){if(13===a.keyCode)return a=document.getElementById("console-input"),send(a.value),a.value=""});document.getElementById("chat-input").addEventListener("keyup",function(a){if(13===a.keyCode){a=document.getElementById("chat-input");for(var b=null,c=0;c<backends.length;c+=1)b=backends[c],__setf_chat(a.value,b);return a.value=""}});
var svgBackgroundLeft='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,0V25"></PATH></SVG>',svgBackgroundRight='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,0V25"></PATH></SVG>',svgBackgroundTop='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,12V25"></PATH></SVG>',
svgBackgroundBottom='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V12.5"></PATH></SVG>',svgBackgroundTopLeft='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,12V25"></PATH></SVG>',svgBackgroundTopRight='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,12V25"></PATH></SVG>',
svgBackgroundBottomLeft='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,0V13"></PATH></SVG>',svgBackgroundBottomRight='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,0V13"></PATH></SVG>',svgBackground='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V25"></PATH></SVG>',
svgBlackLeft='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,0V25"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',svgBlackRight=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,0V25"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',svgBlackTop='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,12V25"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
svgBlackBottom='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V12.5"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
svgBlackTopLeft='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,12V25"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
svgBlackTopRight='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,12V25"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
svgBlackBottomLeft='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,0V13"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
svgBlackBottomRight='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,0V13"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
svgBlack='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V25"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',svgWhiteLeft=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,0V25"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhiteRight='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,0V25"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',
svgWhiteTop='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,12V25"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhiteBottom=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V12.5"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhiteTopLeft=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,12V25"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhiteTopRight=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,12V25"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhiteBottomLeft=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M12,12.5H25M12.5,0V13"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhiteBottomRight=
'<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H13M12.5,0V13"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',svgWhite='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V25"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',
svgBackgroundHoshi='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#dcb35c"></RECT><PATH STROKE="#000" STROKE-WIDTH="1" D="M0,12.5H25M12.5,0V25"></PATH><CIRCLE CX="12.5" CY="12.5" R="2.5"></CIRCLE></SVG>',svgWhiteHoshi=svgWhite,svgBlackHoshi=svgBlack,taflBackgroundPlain='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH></SVG>',
taflBackgroundCross='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 0 L 25 25"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 25 L 25 0"></PATH></SVG>',taflWhitePlain='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',
taflWhiteCross='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 0 L 25 25"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 25 L 25 0"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE></SVG>',
taflBlackPlain='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',taflBlackCross='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 0 L 25 25"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 25 L 25 0"></PATH><DEFS><RADIALGRADIENT ID="$black" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#777"></STOP><STOP OFFSET="0.3" STOP-COLOR="#222"></STOP><STOP OFFSET="1" STOP-COLOR="#000"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$black)"></CIRCLE></SVG>',
taflKingPlain='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE><PATH STROKE="#000" STROKE-WIDTH="3" D="m 2 12.75 L 23 12.75"></PATH><PATH STROKE="#000" STROKE-WIDTH="3" D="m 12.75 2 L 12.75 23"></PATH></SVG>',
taflKingCross='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><PATH STROKE="#000" STROKE-WIDTH="1" FILL="#dcb35c" D="m 0 0 h 25 0 L 25 25 L 0 25 L 0 0"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 0 L 25 25"></PATH><PATH STROKE="#000" STROKE-WIDTH="1" D="m 0 25 L 25 0"></PATH><DEFS><RADIALGRADIENT ID="$white" CX="0.3" CY="0.3" R="0.8"><STOP OFFSET="0" STOP-COLOR="#FFF"></STOP><STOP OFFSET="0.3" STOP-COLOR="#DDD"></STOP><STOP OFFSET="1" STOP-COLOR="#777"></STOP></RADIALGRADIENT></DEFS><CIRCLE CX="12.5" CY="12.5" R="9.375" FILL="url(#$white)"></CIRCLE><PATH STROKE="#000" STROKE-WIDTH="3" D="m 2 12.75 L 23 12.75"></PATH><PATH STROKE="#000" STROKE-WIDTH="3" D="m 12.75 2 L 12.75 23"></PATH></SVG>',
chessBackgroundBlack='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#9a7d40"></RECT></SVG>',chessBackgroundWhite='<SVG XMLNS="http://www.w3.org/2000/svg" VERSION="1.0" HEIGHT="25" WIDTH="25"><RECT HEIGHT="25" WIDTH="25" FILL="#e6ca8d"></RECT></SVG>';function cellId(a,b){return"c-"+a+"-"+b}function svgMark(a,b){return/^(.*)<\/svg>/.exec(a)[1]+b+"</svg>"}
function svgBigCross(a){return['<LINE X1="3.125" Y1="3.125" X2="21.875" Y2="21.875" STROKE="',a,'"></LINE><LINE X1="3.125" Y1="21.875" X2="21.875" Y2="3.125" STROKE="',a,'"></LINE>'].join("")}function svgSmallCross(a){return['<LINE X1="7" Y1="7" X2="17" Y2="17" STROKE="',a,'"></LINE><LINE X1="7" Y1="17" X2="17" Y2="7" STROKE="',a,'"></LINE>'].join("")}
function mark(a,b,c){void 0===c&&(c="gray");return document.getElementById(cellId(a,b)).innerHTML=svgMark(document.getElementById(cellId(a,b)).innerHTML,svgSmallCross(c))}
function buildBoard(a){var b=function(b){for(var c="",d=0;d<a;d+=1)c+=['<TD ID="',cellId(b,d),'" ONCLICK="javascript:doMove(this.id)"></TD>'].join("");return["<TR>",c,"</TR>"].join("")};board.board=function(){for(var b=[],c=1;c<=a;c+=1)b.push(function(){for(var b=[],c=1;c<=a;c+=1)b.push(null);return b}());return b}();for(var c="",d=0;d<a;d+=1)c+=b(d);return["<TABLE>",c,"</TABLE>"].join("")}
function paintGo(a,b,c,d){var e=function(a){if(19===c)return 3===a||4===c-a||a===(c-1)/2;if(13===c)return 3===a||9===a;if(9===c)return 2===a||6===a};if(0===a&&0===b)switch(d){case "white":return svgWhiteTopLeft;case "black":return svgBlackTopLeft;default:return svgBackgroundTopLeft}else if(0===a&&c-1===b)switch(d){case "white":return svgWhiteTopRight;case "black":return svgBlackTopRight;default:return svgBackgroundTopRight}else if(c-1===a&&0===b)switch(d){case "white":return svgWhiteBottomLeft;case "black":return svgBlackBottomLeft;
default:return svgBackgroundBottomLeft}else if(c-1===a&&c-1===b)switch(d){case "white":return svgWhiteBottomRight;case "black":return svgBlackBottomRight;default:return svgBackgroundBottomRight}else if(0===a)switch(d){case "white":return svgWhiteTop;case "black":return svgBlackTop;default:return svgBackgroundTop}else if(c-1===a)switch(d){case "white":return svgWhiteBottom;case "black":return svgBlackBottom;default:return svgBackgroundBottom}else if(0===b)switch(d){case "white":return svgWhiteLeft;
case "black":return svgBlackLeft;default:return svgBackgroundLeft}else if(c-1===b)switch(d){case "white":return svgWhiteRight;case "black":return svgBlackRight;default:return svgBackgroundRight}else if(e(a)&&e(b))switch(d){case "white":return svgWhiteHoshi;case "black":return svgBlackHoshi;default:return svgBackgroundHoshi}else switch(d){case "white":return svgWhite;case "black":return svgBlack;default:return svgBackground}}
function paintTafl(a,b,c,d){var e=(c-1)/2;if(zerop(a)&&zerop(b)||zerop(a)&&b===c-1||a===c-1&&zerop(b)||a===c-1&&b===c-1||a===e&&b===e)switch(d){case "king":return taflKingCross;case "white":return taflWhiteCross;case "black":return taflBlackCross;default:return taflBackgroundCross}else switch(d){case "king":return taflKingPlain;case "white":return taflWhitePlain;case "black":return taflBlackPlain;default:return taflBackgroundPlain}}
function paintChess(a,b,c,d){return!(a%2||b%2)||b%2&&a%2?chessBackgroundWhite:chessBackgroundBlack}function paint(a,b,c,d){if("go"===game)return paintGo(a,b,c,d);if("tafl"===game)return paintTafl(a,b,c,d);if("chess"===game)return paintChess(a,b,c,d)}function paintBoard(a){for(var b=0;b<a;b+=1)for(var c=0;c<a;c+=1)document.getElementById(cellId(b,c)).innerHTML=paint(b,c,a,"start")}function goBeginning(a,b,c){return null}
function taflBeginning(a,b,c){var d=(a-1)/2;return c===d&&b===d?"king":c===d&&Math.abs(d-b)<=((a-3)/2-1)/2+1||b===d&&Math.abs(d-c)<=((a-3)/2-1)/2+1?"white":c===d&&(1>=b||2>=Math.abs(a-b))||b===d&&(1>=c||2>=Math.abs(a-c))?"black":(b===a-1||zerop(b))&&Math.abs(d-c)<=((a-3)/2-1)/2||(c===a-1||zerop(c))&&Math.abs(d-b)<=((a-3)/2-1)/2?"black":null}function chessBeginning(a,b,c){return null}
function populate(a){for(var b=0;b<a;b+=1)for(var c=0;c<a;c+=1){var d=("go"===game?goBeginning:"tafl"===game?taflBeginning:"chess"===game?chessBeginning:null)(a,c,b);d&&board.setMove({col:b,row:c},d,"no-kill",!0)}}function copyMove(a){return{col:a.col,row:a.row,color:a.color}}function moveColplus(a,b){void 0===b&&(b=1);return{col:a.col+b,row:a.row,color:a.color}}function moveRowplus(a,b){void 0===b&&(b=1);return{col:a.col,row:a.row+b,color:a.color}}
function pieceequals(a,b){return a.col===b.col&&a.row===b.row}function bowlForColor(a){switch(a){case "white":return"me";case "black":return"other"}}function __setf_prisoners(a,b){switch(b){case "white":prison.white=a;break;case "black":prison.black=a}return document.getElementById(bowlForColor(b)).innerHTML=b+": "+a}function __setf_game(a,b){return b.setGame(a)}function __setf_size(a,b){return b.setSize(a)}function __setf_chat(a,b){return b.setChat(a)}
function __setf_move(a,b,c){return b.setMove(c,a)}function game(a){return a.game()}function size(a){return a.size()}function chat(a){return a.chat()}function move(a,b){return a.move(b)}function undo(a){return a.undo()}
function doGame(a){if(hosting||a)if(game=a=a||("go"===game?prompt("set board game to tafl or chess","tafl"):"tafl"===game?prompt("set board game to chess or go","chess"):"chess"===game?prompt("set board game to go or tafl","go"):null),member(a,["go","tafl","chess"]))for(var b=null,c=0;c<backends.length;c+=1)b=backends[c],__setf_game(a,b);else return alert("Game must be one of go chess or tafl.");else return alert("Only host can change the game.")}
function doSize(a){if(hosting){a=a||parseInt(prompt("set board size to",19),10);for(var b=null,c=0;c<backends.length;c+=1)b=backends[c],__setf_size(a,b)}else return alert("Only host can resize board.")}function chessMove(a,b){return alert("Chess has not been implemented.")}
function taflMove(a){if(moveStart){var b=move(board,moveStart);board.setMove(moveStart,null,"no-kill",!0);gtp.remove(moveStart);gtp.setMove(moveStart,null,"no-kill",!0);lastMoved={place:moveStart,color:b};for(var c=moveStart=null,d=0;d<backends.length;d+=1)c=backends[d],__setf_move(b,c,a)}else{b=board.move(a);a:{switch(color){case "black":b="black"===b;break a;case "white":b="king"===b||"white"===b;break a}b=void 0}return b?(moveStart=a,mark(a.col,a.row)):alert("invalid move")}}
function doMove(a,b){void 0===b&&(b=color);var c={col:parseInt(/c-([0-9]+)-([0-9]+)/.exec(a)[1]),row:parseInt(/c-([0-9]+)-([0-9]+)/.exec(a)[2])};if("go"===game)for(var d=null,e=0;e<backends.length;e+=1)d=backends[e],__setf_move(b,d,c);else{if("chess"===game)return chessMove(c);if("tafl"===game)return taflMove(c)}}function doUndo(){for(var a=null,b=0;b<backends.length;b+=1)a=backends[b],undo(a)}function doColor(a){color=a||otherColor(color);send("color");return updateColor()}
function gtpHandle(a){var b=null;if(b=/^chat (.*)$/.exec(a)){a=null;for(var c=0;c<backends.length;c+=1)a=backends[c],a!=gtp&&__setf_chat("> "+b[1],a)}else if(b=/^move (.*)$/.exec(a))for(c=0;c<backends.length;c+=1)a=backends[c],a!=gtp&&__setf_move(JSON.parse(b[1]).color,a,{col:JSON.parse(b[1]).col,row:JSON.parse(b[1]).row});else{if(b=/^remove (.*)$/.exec(a))return board.setMove(JSON.parse(b[1]),null,"no-kill",!0);if(/^undo$/.exec(a))for(b=0;b<backends.length;b+=1)a=backends[b],a!=gtp&&undo(a);else{if(/^color$/.exec(a))return color=
otherColor(color),updateColor();if(b=/^game (.*)$/.exec(a))for(c=0;c<backends.length;c+=1)a=backends[c],a!=gtp&&__setf_game(parseInt(b[1]),a);else if(b=/^size (.*)$/.exec(a))for(c=0;c<backends.length;c+=1)a=backends[c],a!=gtp&&__setf_size(parseInt(b[1]),a);else return console.log("received unknown: '"+a+"'")}}}gtp.setGame=function(a){return send("game "+a)};gtp.game=function(){return console.log("gtp.game not defined")};gtp.setSize=function(a){return send("size "+a)};gtp.size=function(){return console.log("gtp.size not defined")};
gtp.setChat=function(a){return send("chat "+a)};gtp.chat=function(){return console.log("gtp.chat not defined")};gtp.setMove=function(a,b){return send("move "+JSON.stringify({col:a.col,row:a.row,color:b}))};gtp.remove=function(a){return send("remove "+JSON.stringify(a))};gtp.move=function(){return console.log("gtp.move not defined")};gtp.undo=function(){return send("undo")};
function setBoardSize(a){board.innerSize=a;document.getElementById("board").innerHTML=buildBoard(a);paintBoard(a);populate(a);__setf_prisoners(0,"white");__setf_prisoners(0,"black");document.getElementById("stones").style.top=50+25*a+"px";document.getElementById("terminals").style.left=25+25*a+"px";return 13>a?document.getElementById("terminals").style.top="3em":document.getElementById("terminals").style.top="1.5em"}
board.setGame=function(a){setBoardSize("go"===a?19:"tafl"===a?9:"chess"===a?8:null);return setBoardSize(size(board))};board.setSize=setBoardSize;board.size=function(){return this.innerSize};board.setChat=function(a){return document.getElementById("chats").appendChild(document.createTextNode(a+"\n"))};board.chat=function(){return console.log("board.chat not defined")};
board.setMove=function(a,b){for(var c=arguments.length,d=2;d<c;d+=2)switch(arguments[d]){case "no-kill":e=arguments[d+1]}var e;board.board[a.col][a.row]=b;("undefined"===typeof e?0:e)||("go"===game?removeDead(otherColor(b),neighbors(a)):"tafl"===game&&taflAttack(a,b));return document.getElementById(cellId(a.col,a.row)).innerHTML=paint(a.col,a.row,size(board),b)};board.move=function(a){return board.board[a.col][a.row]};
board.undo=function(){var a=sgf.moves.slice(-1)[0];a?board.setMove(a,null,"no-kill",!0):alert("no moves to undo");for(var a=lastCulled.places,b=a.length,c=0;c<b;c+=1)board.setMove(a[c],lastCulled.color,"no-kill",!0);lastCulled=null;if(lastMoved)return board.setMove(lastMoved.place,lastMoved.color,"no-kill",!0),lastMoved=null};sgf.setGame=function(a){return console.log("should set sgf game to "+a)};sgf.game=function(){return console.log("sgf.game not defined")};
sgf.setSize=function(a){return console.log("should set sgf size to "+a)};sgf.size=function(){return console.log("sgf.size not defined")};sgf.setChat=function(a){return console.log("should save sgf chat "+a)};sgf.chat=function(){return console.log("sgf.chat not defined")};sgf.setMove=function(a,b){return this.moves.push({col:a.col,row:a.row,color:b})};sgf.move=function(){return console.log("sgf.move not defined")};sgf.undo=function(){return this.moves.pop()};
function neighbors(a){var b=size(board),c=[];a.col!==b-1&&c.push(moveColplus(a));zerop(a.col)||c.push(moveColplus(a,-1));a.row!==b-1&&c.push(moveRowplus(a));zerop(a.row)||c.push(moveRowplus(a,-1));return c}function otherColor(a){switch(a){case "black":return"white";case "white":return"black"}}
function aliveP(a,b){void 0===b&&(b=[]);var c=board.move(a),d=otherColor(c),e=removeIf(function(a){return member(a,b,"test",pieceequals)},neighbors(a)),f=map(function(a){return board.move(a)},e),e=removeIfNot(function(a){return board.move(a)==c},e),g=[a].concat(b),f=some(function(a){return!(a==d||a==c)},f)||some(function(a){var b="undefined"===typeof __PS_MV_REG?__PS_MV_REG=void 0:__PS_MV_REG;try{var c=aliveP(a,g);g=union(g,(aliveP===__PS_MV_REG.tag?__PS_MV_REG.values:[])[0],"test",pieceequals);return c}finally{__PS_MV_REG=
b}},e);__PS_MV_REG={tag:arguments.callee,values:[g]};return f}
function removeDead(a,b){for(var c=[],d=b.length,e=0;e<d;e+=1){var f=b[e];if(move(board,f)==a){var g="undefined"===typeof __PS_MV_REG?__PS_MV_REG=void 0:__PS_MV_REG;try{var h=aliveP(f),k=(aliveP===__PS_MV_REG.tag?__PS_MV_REG.values:[])[0];if(!h)for(var m=k.length,f=0;f<m;f+=1){var l=k[f];c.push(l);__setf_move(null,board,l)}}finally{__PS_MV_REG=g}}}zerop(c.length)||__setf_prisoners(c.length+prison[otherColor(a)],otherColor(a));return lastCulled={places:c,color:a}}
function taflAttack(a,b){for(var c=[],d=null,e=[1,-1],f=0;f<e.length;f+=1)for(var d=e[f],g=null,h=["col","row"],k=0;k<h.length;k+=1)if(g=h[k],g=taflKilled(a,b,g,d))__setf_move(null,board,g),c.push(g);zerop(c.length)||__setf_prisoners(c.length+prison[otherColor(b)],otherColor(b));return lastCulled={places:c,color:otherColor(b)}}function cornerp(a){var b=size(board);return(0===a.row||b-1===a.row)&&(0===a.col||b-1===a.col)}
function taflKilled(a,b,c,d){var e=size(board),f;a:{switch(c){case "col":f=a.col;break a;case "row":f=a.row;break a}f=void 0}f=d+f;var g;a:{switch(c){case "col":g=a.col;break a;case "row":g=a.row;break a}g=void 0}d=2*d+g;if(0<=f&&f<e){g=move;var h=board,k;a:{switch(c){case "col":k={col:f,row:a.row};break a;case "row":k={col:a.col,row:f};break a}k=void 0}g=g(h,k);if("king"===g)if("black"===b){b=all;d=neighbors;a:{switch(c){case "col":e={col:f,row:a.row};break a;case "row":e={col:a.col,row:f};break a}e=
void 0}b=b(function(a){return"black"===move(board,a)||cornerp(a)},d(e))}else b=null;else{if(g=g===otherColor(b))if(g=0<=d){if(e=d<e){e=move;g=board;a:{switch(c){case "col":h={col:d,row:a.row};break a;case "row":h={col:a.col,row:d};break a}h=void 0}if(!(b=e(g,h)===b)){b=cornerp;a:{switch(c){case "col":d={col:d,row:a.row};break a;case "row":d={col:a.col,row:d};break a}d=void 0}b=b(d)}e=b}g=e}b=g}if(b)switch(c){case "col":return{col:f,row:a.row};case "row":return{col:a.col,row:f}}}}doGame(game);
</script></html>